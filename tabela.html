<!DOCTYPE html>
<html lang="pt-br">

<head>
    <title>SIMPLEX</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="node_modules/jquery/dist/jquery.js"></script>
    <script src="node_modules/popper.js/dist/umd/popper.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="node_modules/bootstrap/compiler/style.css">
    <link rel="stylesheet" href="node_modules/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" type="text/css" href="css/estilo.css">
    <script src="./app/models/matriz.js"></script>

    <script>
        window.addEventListener("load", function(event) {
            var variables = parseFloat(window.localStorage.getItem("variables"));
            var restrictions =  parseFloat(window.localStorage.getItem("restrictions"));
            var iterations =  parseFloat(window.localStorage.getItem("iterations"));
            var solution = window.localStorage.getItem("solution");

            var simplexFrame = null;
            var finalSolution = false;

            var nextButton = document.querySelector('#next');
            nextButton.style.display = "none";

            if(solution == "passo") {
                nextButton.style.display = "block";                
            }

            nextButton.addEventListener('click', function(event) {
                simplexFrame = Matriz.generateNewSimplexFrame(simplexFrame);

                if(simplexFrame.checkRowZ() == true) {
                    fillTable(simplexFrame);
                }
                else {
                    if(!finalSolution) {
                        fillTable(simplexFrame);
                        finalSolution = true;
                    }
                }
            });
        
            //Implementacao da classe Matriz
            var data = window.localStorage.getItem("data");
            data = JSON.parse(data);
            console.log(data);

            var matriz = null;

            matriz = new Matriz(restrictions + 1, variables + 1);

            for (var i = 0; i < restrictions; i++) {
                matriz.addInput(data[`f${i+1}`], i);
            }
            
            var option = window.localStorage.getItem("option");

            matriz.addLastRow(data.fo, restrictions, option);
            simplexFrame = Matriz.generateSimplexFrame(matriz);

            if(solution == "direta") {
                var iteratorCount = 0;
                while (true)
                {
                    console.log(simplexFrame.checkRowZ());
                    
                    if (simplexFrame.checkRowZ() == true) {
                        iteratorCount++;
                        simplexFrame = Matriz.generateNewSimplexFrame(simplexFrame);
                        simplexFrame.print();
                    }
                    else
                        break;
                }

                fillTable(simplexFrame);
            }
            else {
                fillTable(simplexFrame);
            }

        });

        function fillTable(simplexFrame) {
            var variables = parseFloat(window.localStorage.getItem("variables"));
            var restrictions =  parseFloat(window.localStorage.getItem("restrictions"));
            var iterations =  parseFloat(window.localStorage.getItem("iterations"));

            var simplexTable = document.querySelector('#simplex');

            var table = "";

            for(var i = 0; i < simplexFrame.rows; i++) {

                if(i == 0) {
                    table = "<thead><tr><th scope='col'>Base</th>";

                    //variaveis de decisao
                    for(var j = 0; j < variables; j++) {
                        table += "<th scope='col'>X"+(j+1)+"</th>";
                    }

                    //variaveis de folga (restricoes)
                    for(var j = 0; j < restrictions; j++) {
                        table += "<th scope='col'>F"+(j+1)+"</th>";
                    }

                    table += "<th scope='col'>B</th>";

                    table += "</tr></thead><tbody>";
                }
                else if(i == simplexFrame.rows-1) {
                    table += "<tr><th scope='row'>Z</th>";

                    for(var j = 0; j < simplexFrame.cols-1; j++) {

                        var number = simplexFrame.data[i-1][j];

                        if(Math.round(number) !== number) {
                            number = number.toFixed(4);
                        }

                        table += "<td scope='col'>"+number+"</td>";
                    }
                }
                else {
                    table += "<tr><th scope='row'>F"+(i)+"</th>";

                    for(var j = 0; j < simplexFrame.cols-1; j++) {

                        var number = simplexFrame.data[i-1][j];

                        if(Math.round(number) !== number) {
                            number = number.toFixed(4);
                        }

                        table += "<td scope='col'>"+number+"</td>";
                    }
                }

            }

            simplexTable.innerHTML = table;
        }

    </script>

</head>

    <body>
        <div class="wrapper fadeInDown">
            <div id="formContent">
                <div class="fadeIn first">
                    <h5>SIMPLEX PO20</h5>
                    <table class="table table-bordered" id="simplex">
                        
                    </table>
                </div>

                <div class="custom-control custom-radio custom-control-inline">
                    <input type="button" id="next" class="fadeIn fourth" value="Avançar" onclick="" style="background-color: blueviolet;">
                </div>




                <!--h5>Análise de Sensibilidade</h5>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th scope="col">Váriavel</th>
                            <th scope="col">Valor Inicial</th>
                            <th scope="col">Valor Final</th>
                            <th scope="col">Uso</th>
                            <th scope="col">Sobra</th>
                            <th scope="col">Preço Sombra</th>
                            <th scope="col">Custo Reduzido</th>
                            <th scope="col">Máximo</th>
                            <th scope="col">Mínimo</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th scope="row"></th>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <th scope="row"></th>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <th scope="row"></th>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table-->
            </div>
    </body>

</html>